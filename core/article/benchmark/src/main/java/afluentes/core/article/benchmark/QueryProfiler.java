package afluentes.core.article.benchmark;

import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import com.jolbox.bonecp.BoneCPDataSource;

public class QueryProfiler {
	public static void main(String[] args) throws SQLException {
		String[] queryList = new String[] {
"select ID, SUBJECT, BODY, SENDER_ID from MESSAGE where ID in (41361, 5949, 48030, 16448, 43516, 81054, 54492, 69762, 18720, 32855, 81078, 32678, 87474, 84263, 31096, 88845, 30085, 67876, 17242, 7321, 59144, 24889, 4525, 21948, 24653, 51261, 3504, 77883, 14693, 10224, 19746, 25246, 92038, 62388, 91603, 75863, 78126, 55654, 17939, 42636, 60961, 72376, 24556, 25731, 41199, 63692, 32075, 39337, 32113, 2063, 3320, 30878, 78417, 89647, 7208, 71617, 33609, 99738, 75144, 9748, 72388, 789, 50106, 25259, 17409, 26518, 63452, 1719, 94359, 41119, 32739, 48073, 41458, 98552, 26727, 12581, 2298, 58663, 54136, 45221, 81268, 13774, 75118, 21670, 7906, 17153, 73790, 80244, 28902, 6242, 97224, 82381, 73669, 23515, 87917, 40724, 81958, 11223, 84606, 32372)",
"select * from USER where ID in (16, 22, 44, 4, 82, 7, 41, 42, 53, 18, 38, 7, 68, 50, 62, 57, 6, 48, 72, 20, 46, 59, 80, 95, 79, 90, 80, 58, 48, 48, 29, 88, 33, 62, 34, 12, 59, 28, 43, 90, 29, 58, 23, 71, 72, 78, 59, 71, 81, 58, 67, 39, 54, 74, 36, 11, 97, 78, 82, 40, 11, 76, 81, 59, 51, 82, 20, 90, 20, 50, 50, 15, 86, 54, 65, 60, 13, 43, 73, 62, 35, 82, 59, 6, 46, 53, 20, 50, 20, 55, 13, 14, 94, 17, 51, 9, 100, 27, 20, 4)",
"select USER.*, MESSAGE_RECIPIENT.MESSAGE_ID from USER, MESSAGE_RECIPIENT where USER.ID = MESSAGE_RECIPIENT.RECIPIENT_ID and MESSAGE_RECIPIENT.MESSAGE_ID in (789, 1719, 2063, 2298, 3320, 3504, 4525, 5949, 6242, 7208, 7321, 7906, 9748, 10224, 11223, 12581, 13774, 14693, 16448, 17153, 17242, 17409, 17939, 18720, 19746, 21670, 21948, 23515, 24556, 24653, 24889, 25246, 25259, 25731, 26518, 26727, 28902, 30085, 30878, 31096, 32075, 32113, 32372, 32678, 32739, 32855, 33609, 39337, 40724, 41119, 41199, 41361, 41458, 42636, 43516, 45221, 48030, 48073, 50106, 51261, 54136, 54492, 55654, 58663, 59144, 60961, 62388, 63452, 63692, 67876, 69762, 71617, 72376, 72388, 73669, 73790, 75118, 75144, 75863, 77883, 78126, 78417, 80244, 81054, 81078, 81268, 81958, 82381, 84263, 84606, 87474, 87917, 88845, 89647, 91603, 92038, 94359, 97224, 98552, 99738)",

"select ID, SUBJECT, BODY, SENDER_ID from MESSAGE where ID in (41361, 5949, 48030, 16448, 43516, 81054, 54492, 69762, 18720, 32855, 81078, 32678, 87474, 84263, 31096, 88845, 30085, 67876, 17242, 7321, 59144, 24889, 4525, 21948, 24653, 51261, 3504, 77883, 14693, 10224, 19746, 25246, 92038, 62388, 91603, 75863, 78126, 55654, 17939, 42636, 60961, 72376, 24556, 25731, 41199, 63692, 32075, 39337, 32113, 2063, 3320, 30878, 78417, 89647, 7208, 71617, 33609, 99738, 75144, 9748, 72388, 789, 50106, 25259, 17409, 26518, 63452, 1719, 94359, 41119, 32739, 48073, 41458, 98552, 26727, 12581, 2298, 58663, 54136, 45221, 81268, 13774, 75118, 21670, 7906, 17153, 73790, 80244, 28902, 6242, 97224, 82381, 73669, 23515, 87917, 40724, 81958, 11223, 84606, 32372)",
"select * from USER where ID in (16, 22, 44, 4, 82, 7, 41, 42, 53, 18, 38, 7, 68, 50, 62, 57, 6, 48, 72, 20, 46, 59, 80, 95, 79, 90, 80, 58, 48, 48, 29, 88, 33, 62, 34, 12, 59, 28, 43, 90, 29, 58, 23, 71, 72, 78, 59, 71, 81, 58, 67, 39, 54, 74, 36, 11, 97, 78, 82, 40, 11, 76, 81, 59, 51, 82, 20, 90, 20, 50, 50, 15, 86, 54, 65, 60, 13, 43, 73, 62, 35, 82, 59, 6, 46, 53, 20, 50, 20, 55, 13, 14, 94, 17, 51, 9, 100, 27, 20, 4)",
"select USER.*, MESSAGE_RECIPIENT.MESSAGE_ID from USER, MESSAGE_RECIPIENT where USER.ID = MESSAGE_RECIPIENT.RECIPIENT_ID and MESSAGE_RECIPIENT.MESSAGE_ID in (789, 1719, 2063, 2298, 3320, 3504, 4525, 5949, 6242, 7208, 7321, 7906, 9748, 10224, 11223, 12581, 13774, 14693, 16448, 17153, 17242, 17409, 17939, 18720, 19746, 21670, 21948, 23515, 24556, 24653, 24889, 25246, 25259, 25731, 26518, 26727, 28902, 30085, 30878, 31096, 32075, 32113, 32372, 32678, 32739, 32855, 33609, 39337, 40724, 41119, 41199, 41361, 41458, 42636, 43516, 45221, 48030, 48073, 50106, 51261, 54136, 54492, 55654, 58663, 59144, 60961, 62388, 63452, 63692, 67876, 69762, 71617, 72376, 72388, 73669, 73790, 75118, 75144, 75863, 77883, 78126, 78417, 80244, 81054, 81078, 81268, 81958, 82381, 84263, 84606, 87474, 87917, 88845, 89647, 91603, 92038, 94359, 97224, 98552, 99738)",

"select ID, SUBJECT, BODY, SENDER_ID from MESSAGE where ID in (41361, 5949, 48030, 16448, 43516, 81054, 54492, 69762, 18720, 32855, 81078, 32678, 87474, 84263, 31096, 88845, 30085, 67876, 17242, 7321, 59144, 24889, 4525, 21948, 24653, 51261, 3504, 77883, 14693, 10224, 19746, 25246, 92038, 62388, 91603, 75863, 78126, 55654, 17939, 42636, 60961, 72376, 24556, 25731, 41199, 63692, 32075, 39337, 32113, 2063, 3320, 30878, 78417, 89647, 7208, 71617, 33609, 99738, 75144, 9748, 72388, 789, 50106, 25259, 17409, 26518, 63452, 1719, 94359, 41119, 32739, 48073, 41458, 98552, 26727, 12581, 2298, 58663, 54136, 45221, 81268, 13774, 75118, 21670, 7906, 17153, 73790, 80244, 28902, 6242, 97224, 82381, 73669, 23515, 87917, 40724, 81958, 11223, 84606, 32372)",
"select * from USER where ID in (16, 22, 44, 4, 82, 7, 41, 42, 53, 18, 38, 7, 68, 50, 62, 57, 6, 48, 72, 20, 46, 59, 80, 95, 79, 90, 80, 58, 48, 48, 29, 88, 33, 62, 34, 12, 59, 28, 43, 90, 29, 58, 23, 71, 72, 78, 59, 71, 81, 58, 67, 39, 54, 74, 36, 11, 97, 78, 82, 40, 11, 76, 81, 59, 51, 82, 20, 90, 20, 50, 50, 15, 86, 54, 65, 60, 13, 43, 73, 62, 35, 82, 59, 6, 46, 53, 20, 50, 20, 55, 13, 14, 94, 17, 51, 9, 100, 27, 20, 4)",
"select USER.*, MESSAGE_RECIPIENT.MESSAGE_ID from USER, MESSAGE_RECIPIENT where USER.ID = MESSAGE_RECIPIENT.RECIPIENT_ID and MESSAGE_RECIPIENT.MESSAGE_ID in (789, 1719, 2063, 2298, 3320, 3504, 4525, 5949, 6242, 7208, 7321, 7906, 9748, 10224, 11223, 12581, 13774, 14693, 16448, 17153, 17242, 17409, 17939, 18720, 19746, 21670, 21948, 23515, 24556, 24653, 24889, 25246, 25259, 25731, 26518, 26727, 28902, 30085, 30878, 31096, 32075, 32113, 32372, 32678, 32739, 32855, 33609, 39337, 40724, 41119, 41199, 41361, 41458, 42636, 43516, 45221, 48030, 48073, 50106, 51261, 54136, 54492, 55654, 58663, 59144, 60961, 62388, 63452, 63692, 67876, 69762, 71617, 72376, 72388, 73669, 73790, 75118, 75144, 75863, 77883, 78126, 78417, 80244, 81054, 81078, 81268, 81958, 82381, 84263, 84606, 87474, 87917, 88845, 89647, 91603, 92038, 94359, 97224, 98552, 99738)"
		};
		BoneCPDataSource ds = null;
		try {
			ds = new BoneCPDataSource();			
			ds.setDriverClass("org.mariadb.jdbc.Driver");
			ds.setDriverClass("com.mysql.jdbc.Driver");
		 	ds.setJdbcUrl("jdbc:mysql://localhost/afluentes");
		 	ds.setUsername("afluentes");
		 	ds.setPassword("afluentes");
		 	ds.setMaxConnectionsPerPartition(100);
//		 	ds.setDefaultReadOnly(true);		 	
//		 	ds.setDefaultTransactionIsolation("READ_UNCOMMITTED");
		 	ds.sanitize();
		 	
			try (Connection c = ds.getConnection();
					Statement s = c.createStatement()) {
				for (int i = 0; i < queryList.length; ++i) {
					String query = queryList[i];
					long t = System.nanoTime();
					int j = 1;
					while (j <= 10000) {
						ResultSet rs = s.executeQuery(query);
						rs.close();
						++j;
					}
					t = System.nanoTime() - t;
					t /= 1000000;
					System.out.println(t + ";" + query);
				}
			}
		} finally {
			if (ds != null) {
				try {
					ds.close();
				} catch (Exception e) {}
			}
		}		
	}
}